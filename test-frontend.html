<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Crawler UI Test</title>
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Component Styles -->
    <style>
        /* Web Crawler Streaming UI Styles */
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
        }
        
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Base Layout */
        .user-message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
        }

        .agent-message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
        }

        .user-avatar,
        .agent-avatar {
            font-size: 24px;
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #f3f4f6;
        }

        .user-content {
            background: #3b82f6;
            color: white;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 70%;
            word-wrap: break-word;
        }

        .agent-response {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Reasoning Steps */
        .reasoning-steps-container {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }

        .reasoning-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .reasoning-icon {
            font-size: 20px;
        }

        .reasoning-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .reasoning-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reasoning-step {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 16px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .step-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .step-number {
            width: 24px;
            height: 24px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .step-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .step-title {
            font-weight: 500;
            color: #1f2937;
        }

        .step-reasoning {
            font-size: 14px;
            color: #6b7280;
        }

        .step-result {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #059669;
        }

        .step-confidence {
            font-size: 12px;
            color: #9ca3af;
        }

        .reasoning-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px;
            color: #6b7280;
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Main Response */
        .main-response {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }

        .response-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .response-icon {
            font-size: 18px;
        }

        .response-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .response-content {
            padding: 20px;
            line-height: 1.6;
            color: #374151;
        }

        .streaming-cursor {
            color: #3b82f6;
            font-weight: bold;
            animation: blink 1s infinite;
        }

        /* Sources */
        .sources-section {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 12px;
            padding: 20px;
        }

        .sources-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .sources-icon {
            font-size: 20px;
        }

        .sources-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .sources-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .source-item {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .source-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .source-content {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .source-link-icon {
            color: #3b82f6;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .source-details {
            flex: 1;
            min-width: 0;
        }

        .source-title {
            font-weight: 500;
            font-size: 14px;
            color: #1f2937;
            margin-bottom: 4px;
            word-break: break-word;
        }

        .source-domain {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 2px;
        }

        .source-url {
            font-size: 12px;
            color: #3b82f6;
            word-break: break-all;
        }

        .sources-count {
            margin-top: 12px;
            font-size: 12px;
            color: #92400e;
            font-style: italic;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes blink {
            0%, 50% { 
                opacity: 1; 
            }
            51%, 100% { 
                opacity: 0; 
            }
        }

        @keyframes spin {
            0% { 
                transform: rotate(0deg); 
            }
            100% { 
                transform: rotate(360deg); 
            }
        }

        .mb-6 {
            margin-bottom: 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .demo-badge {
            background: #dbeafe;
            color: #1d4ed8;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Component: ReasoningStepsDisplay
        const ReasoningStepsDisplay = ({ steps }) => {
            const [visibleSteps, setVisibleSteps] = React.useState(0);
            const [isAnimating, setIsAnimating] = React.useState(false);
            
            React.useEffect(() => {
                if (steps.length === 0) {
                    setVisibleSteps(0);
                    setIsAnimating(false);
                    return;
                }
                
                setIsAnimating(true);
                setVisibleSteps(0);
                
                const timer = setInterval(() => {
                    setVisibleSteps(prev => {
                        if (prev >= steps.length) {
                            clearInterval(timer);
                            setIsAnimating(false);
                            return prev;
                        }
                        return prev + 1;
                    });
                }, 1000); // 1 second delay between steps for demo
                
                return () => {
                    clearInterval(timer);
                    setIsAnimating(false);
                };
            }, [steps.length]);
            
            if (steps.length === 0) return null;
            
            return (
                <div className="reasoning-steps-container">
                    <div className="reasoning-header">
                        <span className="reasoning-icon">🧠</span>
                        <h3 className="reasoning-title">AI Reasoning Process</h3>
                    </div>
                    
                    <div className="reasoning-steps">
                        {steps.slice(0, visibleSteps).map((step, index) => (
                            <div 
                                key={index} 
                                className="reasoning-step"
                                style={{
                                    animationDelay: `${index * 0.1}s`,
                                    animationFillMode: 'both'
                                }}
                            >
                                <div className="step-content">
                                    <div className="step-number">
                                        {index + 1}
                                    </div>
                                    <div className="step-details">
                                        <div className="step-title">
                                            {step.title}
                                        </div>
                                        {step.reasoning && (
                                            <div className="step-reasoning">
                                                {step.reasoning}
                                            </div>
                                        )}
                                        {step.result && (
                                            <div className="step-result">
                                                <span>✓</span>
                                                <span>{step.result}</span>
                                            </div>
                                        )}
                                        {step.confidence && (
                                            <div className="step-confidence">
                                                Confidence: {Math.round(step.confidence * 100)}%
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        {isAnimating && visibleSteps < steps.length && (
                            <div className="reasoning-loading">
                                <div className="loading-spinner"></div>
                                <span>Thinking...</span>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Component: SourcesDisplay
        const SourcesDisplay = ({ sources }) => {
            if (sources.length === 0) return null;
            
            return (
                <div className="sources-section">
                    <div className="sources-header">
                        <span className="sources-icon">📚</span>
                        <h3 className="sources-title">Sources</h3>
                    </div>
                    
                    <div className="sources-list">
                        {sources.map((source, index) => (
                            <div key={index} className="source-item">
                                <div className="source-content">
                                    <span className="source-link-icon">🔗</span>
                                    <div className="source-details">
                                        <div className="source-title">
                                            {source.title || source.url.split('/').pop() || source.domain}
                                        </div>
                                        <div className="source-domain">
                                            {source.domain}
                                        </div>
                                        <div className="source-url">
                                            {source.url}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    <div className="sources-count">
                        {sources.length} source{sources.length !== 1 ? 's' : ''} crawled
                    </div>
                </div>
            );
        };

        // Component: StreamingContent
        const StreamingContent = ({ content, isStreaming }) => {
            return (
                <div className="response-content">
                    {content}
                    {isStreaming && (
                        <span className="streaming-cursor">|</span>
                    )}
                </div>
            );
        };

        // Main App Component
        const App = () => {
            // Test data matching your backend format
            const testData = {
                userMessage: {
                    role: 'user',
                    content: 'What are the API rate limits for your service?',
                    created_at: Date.now() - 30000
                },
                agentMessage: {
                    role: 'agent',
                    content: `Based on the scraped content from the API documentation, here are the key points about rate limits:

## API Rate Limits

The API implements the following rate limiting policies:

### Free Tier
- **100 requests per hour** per API key
- **1,000 requests per day** maximum
- Rate limit resets at the top of each hour

### Premium Tier  
- **1,000 requests per hour** per API key
- **50,000 requests per day** maximum
- Burst capacity of up to 2,000 requests in a 5-minute window

### Rate Limit Headers
All API responses include these headers:
- \`X-RateLimit-Limit\`: Your rate limit ceiling for that request
- \`X-RateLimit-Remaining\`: Number of requests left for the time window
- \`X-RateLimit-Reset\`: UTC timestamp when the rate limit resets

### Best Practices
1. **Implement exponential backoff** when you receive 429 responses
2. **Cache responses** when possible to reduce API calls
3. **Use webhooks** instead of polling for real-time updates
4. **Batch requests** when the API supports it

If you exceed the rate limit, you'll receive a 429 status code with a retry-after header.`,
                    created_at: Date.now(),
                    tool_calls: [{
                        tool_call_id: 'call_abc123',
                        tool_name: 'crawl_selected_urls',
                        tool_args: {
                            urls: [
                                'https://docs.api.com/rate-limits',
                                'https://docs.api.com/authentication', 
                                'https://docs.api.com/best-practices',
                                'https://help.api.com/troubleshooting'
                            ]
                        },
                        metrics: {
                            time: 4.2
                        },
                        created_at: Date.now()
                    }],
                    extra_data: {
                        reasoning_steps: [
                            {
                                title: 'Analyzing the user question',
                                reasoning: 'The user is asking about API rate limits, which requires specific technical documentation',
                                result: 'Identified need for rate limiting documentation',
                                confidence: 0.95
                            },
                            {
                                title: 'Selecting relevant documentation URLs',
                                reasoning: 'Choosing pages that contain rate limiting policies, authentication details, and best practices',
                                result: 'Selected 4 high-quality documentation sources',
                                confidence: 0.89
                            },
                            {
                                title: 'Crawling and extracting content',
                                reasoning: 'Retrieving the most up-to-date information from official API documentation',
                                result: 'Successfully crawled 4 pages in 4.2 seconds',
                                confidence: 0.92
                            },
                            {
                                title: 'Synthesizing comprehensive answer',
                                reasoning: 'Combining information from multiple sources to provide complete rate limiting details',
                                result: 'Created detailed response covering all rate limit aspects',
                                confidence: 0.97
                            }
                        ]
                    }
                }
            };

            // Extract sources from tool calls
            const sources = testData.agentMessage.tool_calls[0].tool_args.urls.map(url => {
                try {
                    const urlObj = new URL(url);
                    return {
                        url,
                        domain: urlObj.hostname,
                        title: url.split('/').pop() || urlObj.pathname
                    };
                } catch {
                    return {
                        url,
                        domain: 'Unknown',
                        title: url
                    };
                }
            });

            return (
                <div className="test-container">
                    <div className="header">
                        <div className="demo-badge">🚀 Live Demo</div>
                        <h1>Web Crawler Streaming UI Test</h1>
                        <p>Testing your custom streaming components with realistic data from your backend</p>
                    </div>
                    
                    {/* User Message */}
                    <div className="user-message">
                        <div className="user-avatar">👤</div>
                        <div className="user-content">{testData.userMessage.content}</div>
                    </div>
                    
                    {/* Agent Response */}
                    <div className="agent-message">
                        <div className="agent-avatar">🤖</div>
                        <div className="agent-response">
                            {/* Reasoning Steps */}
                            <ReasoningStepsDisplay 
                                steps={testData.agentMessage.extra_data.reasoning_steps} 
                            />
                            
                            {/* Main Content */}
                            <div className="main-response mb-6">
                                <div className="response-header">
                                    <span className="response-icon">💬</span>
                                    <h3 className="response-title">Response</h3>
                                </div>
                                <StreamingContent 
                                    content={testData.agentMessage.content}
                                    isStreaming={false}
                                />
                            </div>
                            
                            {/* Sources */}
                            <SourcesDisplay sources={sources} />
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
